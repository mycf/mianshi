1. 为什么使用分布式锁
使用分布式锁的一个核心目的是为了解决在同一个时刻，多个进程或者多个线程去访问某个共享资源所带来的安全性问题。
而根据锁的用途，可以分为两类：
第一类是共享锁，就是在同一时刻允许多个进程或者线程去访问某个共享资源，可以适用幂等性的场景中，从而避免重复加锁带来的性能开销。
第二类是排它锁，在同一个时刻只允许一个线程或者进程访问共享资源，适合在非幂等性的场景中。

目前常使用redis和zookeeper实现分布式锁。

Redis可以通过两种方式实现分布式锁：
第一种是基于Redis本身提供的setnx指令，setnx设置key时，如果key已存在会返回0，表示无法设置，否则返回1，表示设置成功。通过机制去判断是否获得锁
第二种是基于redisson，redisson提供了分布式锁的封装方法，只需要调用api就行了。redisson里面的指令都是通过lua脚本实现的，lua脚本可以保证脚本执行的原子性。另外，redisson还提供了watchdog，翻译过来就是看门狗，它会在获取锁之后，每隔10秒钟把key的时间续约，从而避免锁的过期。

zookeeper实现分布式锁：
通过临时有序节点实现，线程去zookeeper


| jjfasf |  | \ |
| ---- | ---- | ---- |
| asdf |  |  |
|  |  |  |
|  |  |  |

| 步骤 | bb |  |
| ---- | ---- | ---- |
|  |  |  |
|  |  |  |
![[分布式锁 2023-12-26 12.53.41.excalidraw]]